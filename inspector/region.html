<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8"/>
        <title>Habitat Inspector</title>
        <style type="text/css">
            body {
                margin:40px auto;
                line-height:1.6;
                font-size:18px;
                color:#444;
                padding:0 10px
            }
            h1,h2,h3 {
                line-height:1.2
            }
        </style>
    </head>
    <body>
        <h1>Region - <span id="filename"></span></h1>
        <div id="region" style="position: relative; width: 960px; height: 384px; overflow: hidden;">
        </div>
        <div>
            <h2>Neighboring regions</h2>
            <ul id="nav"></ul>
        </div>
        <div>
            <h2>Objects</h2>
            <ul id="objects"></ul>
        </div>
        <div id="errors"></div>
        <a href="index.html">Home</a>

        <script type="module">
            import { regionShower } from "./region.js"

            window.showErrors = () => {
                document.getElementById('errors').style.display = 'block'
            }
            const q = new URLSearchParams(window.location.search)
            const filename = q.get("f") ?? "db/new_Downtown/Downtown_4d.json"

            const onload = async () => {
                const observer = (ev, obj) => {
                    if (ev == "filename") {
                        document.getElementById('filename').innerText = obj
                    } else if (ev == "object" && obj.type == "context" && obj.name) {
                        document.getElementById('filename').innerText = obj.name
                    }
                }
                const showRegion = await regionShower(
                    { errorContainer: document.getElementById("errors"),
                      regionContainer: document.getElementById("region"),
                      objectContainer: document.getElementById("objects"),
                      navContainer: document.getElementById("nav"),
                      observer
                    }
                )
                await showRegion(filename)
            }
            onload()
        </script>
    </body>
</html>